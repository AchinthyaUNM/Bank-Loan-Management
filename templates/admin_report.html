<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Reports & Auditing</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .report-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .report-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .filter-section {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">Admin Reports & Auditing</h2>

        <div class="report-section">
            <h5 class="report-title">Overall Loan Statistics</h5>
            <p><strong>Total Loan Applications:</strong> <span id="totalApplications"></span></p>
            <p><strong>Total Loans Approved:</strong> <span id="totalApprovedLoans"></span></p>
            <p><strong>Total Loans Rejected:</strong> <span id="totalRejectedLoans"></span></p>
            <p><strong>Total Outstanding Loan Amount:</strong> <span id="totalOutstandingAmount"></span></p>
        </div>

        <div class="report-section">
            <h5 class="report-title">Loan Repayment Status</h5>
            <div class="filter-section">
                <form id="repaymentFilterForm" class="form-inline">
                    <div class="form-group mr-2">
                        <label for="repaymentStatusFilter" class="mr-2">Filter by Status:</label>
                        <select class="form-control" id="repaymentStatusFilter">
                            <option value="">All</option>
                            <option value="PENDING">Pending</option>
                            <option value="COMPLETED">Completed</option>
                        </select>
                    </div>
                    <button type="button" class="btn btn-primary" id="filterRepaymentsBtn">Apply Filter</button>
                </form>
            </div>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Repayment ID</th>
                        <th>Application ID</th>
                        <th>Due Date</th>
                        <th>Amount Due</th>
                        <th>Payment Date</th>
                        <th>Payment Status</th>
                    </tr>
                </thead>
                <tbody id="allRepaymentsTableBody">
                </tbody>
            </table>
            <p id="noRepaymentsAdmin" class="text-muted" style="display:none;">No repayments found.</p>
        </div>

        <div class="report-section">
            <h5 class="report-title">Customer Portfolio</h5>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Customer ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Total Active Loans</th>
                        <th>Total Outstanding Balance</th>
                    </tr>
                </thead>
                <tbody id="customerPortfolioTableBody">
                </tbody>
            </table>
            <p id="noCustomers" class="text-muted" style="display:none;">No customer data available.</p>
        </div>

        <div class="report-section">
            <h5 class="report-title">Audit Logs (Example)</h5>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>User</th>
                        <th>Action</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody id="auditLogTableBody">
                    <tr>
                        <td>2025-05-07 10:00:00</td>
                        <td>AdminUser</td>
                        <td>Loan Approved</td>
                        <td>Application ID: 101</td>
                    </tr>
                    <tr>
                        <td>2025-05-06 15:30:15</td>
                        <td>Customer123</td>
                        <td>Payment Made</td>
                        <td>Repayment ID: 205, Amount: ₹500</td>
                    </tr>
                </tbody>
            </table>
            <p id="noLogs" class="text-muted" style="display:none;">No audit logs available.</p>
        </div>

        <hr>
        <p><a href="#">Back to Admin Dashboard</a></p>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            // --- Dummy Data (Replace with actual API calls) ---
            const overallStats = {
                totalApplications: 150,
                totalApprovedLoans: 100,
                totalRejectedLoans: 50,
                totalOutstandingAmount: 550000.75
            };

            const allRepayments = [
                { repaymentId: 201, applicationId: 101, dueDate: '2025-05-15', amountDue: 500.25, paymentDate: '2025-05-14', paymentStatus: 'COMPLETED' },
                { repaymentId: 202, applicationId: 101, dueDate: '2025-06-15', amountDue: 500.25, paymentDate: null, paymentStatus: 'PENDING' },
                { repaymentId: 203, applicationId: 102, dueDate: '2025-05-20', amountDue: 750.00, paymentDate: '2025-05-19', paymentStatus: 'COMPLETED' },
                { repaymentId: 204, applicationId: 103, dueDate: '2025-05-25', amountDue: 1000.00, paymentDate: null, paymentStatus: 'PENDING' }
            ];

            const customerPortfolio = [
                { customerId: 1, name: 'Alice Smith', email: 'alice.smith@example.com', totalActiveLoans: 1, totalOutstandingBalance: 10000.50 },
                { customerId: 2, name: 'Bob Johnson', email: 'bob.johnson@example.com', totalActiveLoans: 2, totalOutstandingBalance: 25000.00 },
                { customerId: 3, name: 'Charlie Brown', email: 'charlie.brown@example.com', totalActiveLoans: 0, totalOutstandingBalance: 0.00 }
            ];

            // Populate Overall Statistics
            $('#totalApplications').text(overallStats.totalApplications);
            $('#totalApprovedLoans').text(overallStats.totalApprovedLoans);
            $('#totalRejectedLoans').text(overallStats.totalRejectedLoans);
            $('#totalOutstandingAmount').text('₹' + overallStats.totalOutstandingAmount.toFixed(2));

            // Function to populate the Repayments Table
            function populateRepaymentsTable(repayments) {
                $('#allRepaymentsTableBody').empty();
                if (repayments.length > 0) {
                    repayments.forEach(repayment => {
                        $('#allRepaymentsTableBody').append(`
                            <tr>
                                <td>${repayment.repaymentId}</td>
                                <td>${repayment.applicationId}</td>
                                <td>${repayment.dueDate}</td>
                                <td>₹${repayment.amountDue.toFixed(2)}</td>
                                <td>${repayment.paymentDate || '-'}</td>
                                <td>${repayment.paymentStatus}</td>
                            </tr>
                        `);
                    });
                    $('#noRepaymentsAdmin').hide();
                } else {
                    $('#noRepaymentsAdmin').show();
                }
            }

            // Initial population of the Repayments Table
            populateRepaymentsTable(allRepayments);

            // Filter Repayments based on selected status
            $('#filterRepaymentsBtn').click(function() {
                const selectedStatus = $('#repaymentStatusFilter').val();
                let filteredRepayments = allRepayments;
                if (selectedStatus) {
                    filteredRepayments = allRepayments.filter(repayment => repayment.paymentStatus === selectedStatus);
                }
                populateRepaymentsTable(filteredRepayments);
            });

            // Populate Customer Portfolio Table
            if (customerPortfolio.length > 0) {
                customerPortfolio.forEach(customer => {
                    $('#customerPortfolioTableBody').append(`
                        <tr>
                            <td>${customer.customerId}</td>
                            <td>${customer.name}</td>
                            <td>${customer.email}</td>
                            <td>${customer.totalActiveLoans}</td>
                            <td>₹${customer.totalOutstandingBalance.toFixed(2)}</td>
                        </tr>
                    `);
                });
                $('#noCustomers').hide();
            } else {
                $('#noCustomers').show();
            }

            // --- End of Dummy Data ---

            // In a real application, you would use AJAX calls to fetch data:
            // $.ajax({
            //     url: '/api/admin/reports/overallStats',
            //     method: 'GET',
            //     success: function(data) {
            //         $('#totalApplications').text(data.totalApplications);
            //         // ... and so on
            //     }
            // });

            // $.ajax({
            //     url: '/api/admin/reports/repayments',
            //     method: 'GET',
            //     success: function(data) {
            //         populateRepaymentsTable(data);
            //     }
            // });

            // $('#filterRepaymentsBtn').click(function() {
            //     const selectedStatus = $('#repaymentStatusFilter').val();
            //     $.ajax({
            //         url: `/api/admin/reports/repayments?status=${selectedStatus}`,
            //         method: 'GET',
            //         success: function(data) {
            //             populateRepaymentsTable(data);
            //         }
            //     });
            // });

            // $.ajax({
            //     url: '/api/admin/reports/customerPortfolio',
            //     method: 'GET',
            //     success: function(data) {
            //         if (data.length > 0) {
            //             data.forEach(customer => {
            //                 // Populate customer portfolio table
            //             });
            //             $('#noCustomers').hide();
            //         } else {
            //             $('#noCustomers').show();
            //         }
            //     }
            // });

            // $.ajax({
            //     url: '/api/admin/reports/auditLogs',
            //     method: 'GET',
            //     success: function(data) {
            //         if (data.length > 0) {
            //             data.forEach(log => {
            //                 // Populate audit log table
            //             });
            //             $('#noLogs').hide();
            //         } else {
            //             $('#noLogs').show();
            //         }
            //     }
            // });
        });
    </script>
</body>
</html>